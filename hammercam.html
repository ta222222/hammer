<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>hammercam v2</title>

<style>
video { display: none; }

#info-modal {
    display: inline-block;
    vertical-align: top;
    margin-left: 2em;
    padding: 1em 1.5em;
    background: rgba(0,0,0,0.8);
    color: #fff;
    border-radius: 8px;
    font-family: helvetica neue;
    font-size: 1em;
    min-width: 200px;
    max-width: 300px;
}

#dithered {
    height: 20em;
    margin: 1em;
    display: inline-block;
    vertical-align: top;
}

#bottom-gif {
    position: fixed;
    bottom: 0.25em;
    left: 50%;
    transform: translateX(-50%) scale(0.17);
    transform-origin: center;
    z-index: 9999;
    pointer-events: none;
}
</style>
</head>

<body>
<video id="webcam" autoplay playsinline></video>
<img id="dithered" alt="webcam will display here" />

<div id="info-modal">
    <strong>Info</strong><br>
    Frame rate: <span id="fps">0</span> FPS<br>
    Resolution: <span id="res">-</span><br>
    Mirror: <span id="mirror">on</span><br>
</div>

<img id="bottom-gif" src="https://raw.githubusercontent.com/ta222222/hammer/refs/heads/main/hammercam.svg">

<script src="lol.js"></script>

<script>
// Elements
const video       = document.getElementById('webcam');
const ditheredImg = document.getElementById('dithered');
const fpsSpan     = document.getElementById('fps');
const resSpan     = document.getElementById('res');

// Canvas for processing
const canvas = document.createElement('canvas');
const ctx     = canvas.getContext('2d');

// FPS tracking
let lastSecond = performance.now();
let frameCount = 0;
let running    = false;

// Get webcam
navigator.mediaDevices.getUserMedia({ video: true })
    .then(stream => video.srcObject = stream)
    .catch(err => alert('Could not access webcam: ' + err));

// Main loop
function loop() {
    if (!running) return;

    if (video.readyState === video.HAVE_ENOUGH_DATA) {

        // Resize canvas if video dims changed
        if (canvas.width !== video.videoWidth) {
            canvas.width  = video.videoWidth;
            canvas.height = video.videoHeight;
        }

        // Mirror + draw frame
        ctx.save();
        ctx.setTransform(-1, 0, 0, 1, canvas.width, 0);
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        ctx.restore();

        // Get pixel data
        let imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);

        // Apply your dithering directly to pixel data
        ditherImage(imgData.data);   // <----- from lol.js

        // Put modified pixels back
        ctx.putImageData(imgData, 0, 0);

        // Convert to JPEG fast & display
        ditheredImg.src = canvas.toDataURL('image/jpeg', 0.5);

        // FPS calc
        frameCount++;
        let now = performance.now();
        if (now - lastSecond >= 1000) {
            fpsSpan.textContent = frameCount;
            frameCount = 0;
            lastSecond = now;
        }

        resSpan.textContent = `${canvas.width} Ã— ${canvas.height}`;
    }

    requestAnimationFrame(loop);
}

// Start once
video.addEventListener('play', () => {
    if (!running) {
        running = true;
        loop();
    }
});
</script>

</body>
</html>

